<script>
  const baybayinInput = document.getElementById('baybayinInput');
  const latinOutput = document.getElementById('latinOutput');

  const baybayinToLatin = {
    "ᜀ": "A", "ᜁ": "I", "ᜂ": "U", "ᜃ": "KA", "ᜄ": "GA",
    "ᜅ": "NGA", "ᜆ": "TA", "ᜇ": "DA", "ᜈ": "NA",
    "ᜉ": "PA", "ᜊ": "BA", "ᜋ": "MA", "ᜌ": "YA",
    "ᜎ": "LA", "ᜏ": "WA", "ᜐ": "SA", "ᜑ": "HA"
  };

  function translateBaybayin(text) {
    let result = [];
    let i = 0;
    while (i < text.length) {
      let char = text[i];
      let next = text[i + 1] || '';
      let base = baybayinToLatin[char];

      if (base) {
        // Remove vowel if virama
        if (next === '᜔') {
          result.push(base.slice(0, -1)); // e.g. KA → K
          i++;
        }
        // Replace vowel with I
        else if (next === 'ᜒ') {
          result.push(base.slice(0, -1) + 'I');
          i++;
        }
        // Replace vowel with U
        else if (next === 'ᜓ') {
          result.push(base.slice(0, -1) + 'U');
          i++;
        }
        // Default (no kudlit)
        else {
          result.push(base);
        }
      } else if (char === '␣' || char === ' ') {
        result.push(' ');
      } else {
        result.push(char); // unknown symbol
      }
      i++;
    }

    return "Translation: " + result.join(" ");
  }

  baybayinInput.addEventListener("input", () => {
    latinOutput.textContent = translateBaybayin(baybayinInput.value);
  });

  document.querySelectorAll(".key").forEach(button => {
    button.addEventListener("click", () => {
      const value = button.textContent;
      if (value === "⛔") {
        clearText();
      } else if (value === "⌫") {
        deleteLast();
      } else if (value === "␣") {
        baybayinInput.value += " ";
      } else {
        baybayinInput.value += value;
      }
      latinOutput.textContent = translateBaybayin(baybayinInput.value);
    });
  });

  function deleteLast() {
    let current = baybayinInput.value;
    baybayinInput.value = current.slice(0, -1);
    latinOutput.textContent = translateBaybayin(baybayinInput.value);
  }

  function clearText() {
    baybayinInput.value = "";
    latinOutput.textContent = "Translation:";
  }
</script>
